(function(){(function(f,d){var c,g,b,e;e="PersistentGrass";b=d.document;g={debug:false};c=(function(){function h(j,i){this.element=j;this.options=f.extend({},g,i);this.element=f(this.element);this._defaults=g;this._name=e;this.init()}h.prototype.init=function(){this.element.on("mouseenter",function(i){return this.style.border="1px dotted grey"});this.element.on("mouseleave",function(i){return this.style.border="0px"});this.element.on("dragstart",this.dragstart);this.element.on("drag",this.drag);this.element.on("dragend",this.dragend);this.element.on("changed",this.changed);return this.element.on("click",this.resizestart)};h.prototype.resizestart=function(j){var i;if(f(j.target).data("dragging")){return}i=f(this).data("resizing")===1?0:1;f(this).data("resizing",i);return console.log(f(this).data("resizing"))};h.prototype.dragstart=function(i){f(this).data("dragging",true);f(this).data("opacity",this.style.opacity);this.style.border="1px dotted grey";return this.style.opacity=0.4};h.prototype.drag=function(i){f(this).attr("draggable","true");this.style.top=i.originalEvent.y+"px";this.style.left=i.originalEvent.x+"px";return this.style.position="absolute"};h.prototype.dragend=function(i){f(this).data("dragging",false);this.style.opacity=f(this).data("opacity")>0?f(this).data("opacity"):1;f(this).trigger("changed","top",i.y);return f(this).trigger("changed","left",i.x)};h.prototype.changed=function(j,i){var k;k=f(this).attr("id");return f.ajax("/object/",{type:"PUT",dataType:"json",data:JSON.stringify({id:k,attr:j,result:i})})};return h})();return f.fn[e]=function(h){return this.each(function(){if(!f.data(this,"plugin_"+e)){return f.data(this,"plugin_"+e,new c(this,h))}})}})(jQuery,window)}).call(this);jQuery.fn.outerHTML=function(b){return b?this.before(b).remove():jQuery("<p>").append(this.eq(0).clone()).html()};function get_page(){a=location.pathname.match(/\/(.*)/);if(a==""){a="index"}return Array(0,a)}function get_current_subpage(){a=get_page();return a[2]}function get_current_page(){a=get_page();return a[1]}function get_o(b){return $(b).parent().parent().parent().parent()}function get_number(b){return b.replace(/[a-z]/gi,"").replace("_","")}function increment_zindex(b){$(b).persistentcss("z-index",parseInt(b.css("z-index"),10)+1)}function downgrade_zindex(b){$(b).persistentcss("z-index",parseInt(b.css("z-index"),10)-1)}function delete_page(){if(get_current_page()=="index"){alert("You cannot delete index page");return false}$.ajax({url:"/delete/page/"+get_current_page(),type:"DELETE",});new_object("menu","index");document.location.href="/"}function create_page(){new_object("page",$("#new_page").val());new_object("menu",get_current_page())}function delete_(b){$.ajax({url:"/delete/"+$(b).attr("id")+"/",type:"DELETE",success:function(c){$(b).hide()}})}function new_object(b,c){if(!c||c==""){c=get_current_page()[0]}if(!c||c==""||c=="/"){c="index"}console.debug(c);$.ajax({url:"/new/"+b+"/"+c,type:"POST",success:function(d){if(b=="menu"&&$(".menu")[0]){$(".menu").html(d);$(".static_html").persistent("static_html");document.location.reload()}else{$("#filedrag").append(d);document.location.reload()}}})}function grasscms_startup(){$("video,audio").mediaelementplayer();$(".draggable-x-handle").each(function(){makeGuideX(this)});$(".draggable-y-handle").each(function(){makeGuideY(this)});$("textarea").each(function(){id=$(this).parent().attr("id")+"_textarea";$(this).attr("id",id);$("#"+id).wysihtml5({events:{focus:function(b){$(this.textareaElement.parentNode).children(".handler").show();$(this.textareaElement.parentNode).children("iframe").toggleClass("with_shadow");$(this.toolbar.container).show()},blur:function(){$(this.textareaElement.parentNode).children("iframe").toggleClass("with_shadow");$(this.textareaElement.parentNode).children(".handler").hide();$(this.toolbar.container).hide()},change:function(){window.foo=this;$(this.textareaElement).persistentdata("content",this.composer.doc.body.innerHTML)}}})});setup_standard_tools();$("#fakefiles").live("click",function(){$("#files").click()});$("#filedrag").disableSelection();$(".static_html").persistent("static_html");$(".static_html").each(function(){$("#"+$(this).attr("id")).rotatable()});$(".slider").each(function(){$(this).slider({min:0,max:1,step:0.1,value:$(this).parent().parent().parent().css("opacity"),orientation:"horizontal",slide:function(c,b){if($(c.target).parent().parent().parent().parent().attr("id")!="filedrag"){$(c.target).parent().parent().parent().parent().persistentcss("opacity",b.value)}}})});options={placement:"bottom"};$("#addpage").tooltip(options);$("#editimage").tooltip(options);$("#addmenu").tooltip(options);$("#addtext").tooltip(options);$("#fakefiles").tooltip(options);$("#delpage").tooltip(options)}function setup_standard_tools(){$("#filedrag>div").hoverIntent({timeout:500,out:function(b){$(b.currentTarget).children(".standard_tools").hide()},over:function(b){$(b.currentTarget).children(".standard_tools").show()}})}jQuery.fn.extend({persistentdata:function(c,b){$(this).trigger("cssModified",[c,"in_post",b])},persistentcss:function(c,b){$(this).css(c,b);$(this).trigger("cssModified",[c,b])},persistent:function(g){function c(l,k,j,i){$.ajax({type:"POST",url:"/set/"+k+"/"+l+"/"+j,data:{result:i}})}function h(i,j){c(i.data("id"),j,i.css(j))}function f(k,l,j,i){if(!i){i="elem"}$.ajax({url:"/get/"+l+"/"+k.attr("id"),method:"POST",type:"POST",success:function(m){$(j).each(function(){k.children(".img").css("top","auto").css("left","auto");k.css(this+"",i.replace("elem",m))})}})}function e(i,k,j){c(k,"width",j.size.width);c(k,"height",j.size.height)}function d(i,k,j){c(k,"x",j.position.top);c(k,"y",j.position.left)}function b(i,j){page=get_page();$.ajax({url:"/set_page/"+page[1]+"/"+page[2]+"/"+i+"/"+j,method:"POST",type:"POST",success:function(k){if(elem=="width"){$("#filedrag").width(k);$("body").width(k)}else{$("#filedrag").height(k);$("body").height(k)}}})}return this.each(function(){var i=$(this);i.bind("cssModified",function(k,n,m,l){c($(k.currentTarget).attr("id"),n,m,l)});if(i.children(g).length>0){var j=get/number(i.children(g).attr("id"))}else{var j=get_number(i.attr("id"))}if(i.parent().attr("id")!="filedrag"){i=i.parent()}i.resizable({alsoResize:$.merge(i.children(".wysihtml5-sandbox"),i.children(".alsoResizable")),stop:function(k,l){e(g,j,l)}}).draggable({drag:function(k,l){wh=$(window).height();ww=$(window).width();this_h=l.position.top;this_w=l.position.left;if((wh-this_h-100)<0){b("height",this_h)}if((ww-this_w-100)<0){b("width",this_w)}},stop:function(k,l){d(g,j,l)}});i.append($("#standard_tools_model").html());console.debug(i);f(i,"zindex",Array("opacity"));f(i,"opacity",Array("opacity"));f(i,"rotation",Array("-moz-transform","-webkit-transform","-o-transform","-ms-transform"),"rotate(elem)");f(i,"x",Array("top"),"elempx");f(i,"y",Array("left"),"elempx")})}});