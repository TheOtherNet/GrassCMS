(function(){(function(f,c){var b,e,a,d;d="PersistentGrass";a=c.document;e={debug:false,offset:250};b=(function(){function g(i,h){this.element=i;this.options=$.extend({},e,h);this.element=$(this.element);this._defaults=e;this._name=d;this.init()}g.prototype.init=function(){this.do_resizable();this.element.on("mouseenter",this.mouseenter);this.element.on("mouseleave",this.mouseleave);this.element.on("dragstart",this.dragstart);this.element.on("drag",this.drag);this.element.on("dragend",this.dragend);this.element.on("click",this.element_clicked);this.element.on("changed",this.changed);this.element.on("contextmenu",this.contextmenu);this.element.data("offset",this.options.offset);return $("#current_element_name").html("GrassCMS")};g.prototype.element_clicked=function(h){var k,i,j;k=$($(this).children()[0]).attr("id");$("#panel_left").data("current_element",k);if($(this).children("img").attr("src")){i=$(this).children("img").attr("src").split("/");j=i[i.length-1]}else{if($(this).children("div")){j="Text element"}}if(h.shiftKey){$($(this).children()[0]).attr("contentEditable","true")}return $("#current_element_name").html(j)};g.prototype.clear_all=function(){return $("#current_element_name").html("GrassCMS")};g.prototype.mouseenter=function(){return this.style.border="1px dotted grey"};g.prototype.contextmenu=function(h){$("#menu").css("top",h.originalEvent.y-35);$("#menu").css("left",h.originalEvent.x-300);$("#menu").show();return false};g.prototype.mouseleave=function(){$($(this).children()[0]).attr("contentEditable","false");this.style.border="0px";if($(this).css("height")!==$(this).data("height")){$(this).trigger("changed","height",this.style.height);$(this).data("height",$(this).css("height"))}if($(this).css("width")!==$(this).data("width")){$(this).trigger("changed","width",this.style.width);return $(this).data("width",$(this).css("width"))}};g.prototype.do_resizable=function(){this.element=this.element.wrap('<div class="resizable">').parent();this.element.data("width",this.element.css("width"));return this.element.data("height",this.element.css("height"))};g.prototype.dragstart=function(h){$(this).trigger("click");$(this).data("opacity",this.style.opacity);this.style.border="1px dotted grey";return this.style.opacity=0.4};g.prototype.drag=function(h){$(this).attr("draggable","true");this.style.top=h.originalEvent.y+"px";if(h.originalEvent.x>$(this).data("offset")){this.style.left=h.originalEvent.x-$(this).data("offset")+"px"}return this.style.position="absolute"};g.prototype.dragend=function(h){this.style.opacity=$(this).data("opacity")>0?$(this).data("opacity"):1;$(this).trigger("changed","top",h.y);return $(this).trigger("changed","left",h.x)};g.prototype.changed=function(i,h){var j;j=$(this).attr("id");return $.ajax("/object/",{type:"PUT",dataType:"json",data:JSON.stringify({id:j,attr:i,result:h})})};return g})();return $.fn[d]=function(g){return this.each(function(){if(!$.data(this,"plugin_"+d)){return $.data(this,"plugin_"+d,new b(this,g))}})}})(jQuery,window);($(document)).ready(function(){($(document)).on("click",function(a){if(a.button===0&&a.target.parentNode.id!=="#menu"){return $("#menu").css("display","none")}});($("#opacitypicker")).on("change",function(){if($("#panel_left").data("current_element")){return $("#"+$("#panel_left").data("current_element")).css("opacity",$("#opacitypicker").val())}});return($("#colorpicker")).on("change",function(){if($("#panel_left").data("current_element")){return $("#"+$("#panel_left").data("current_element")).css("background",$("#colorpicker").val())}else{return $("body").css("background",$("#colorpicker").val())}})})}).call(this);